# 🏗️ AI QCM Data Structure

## 🎯 **MVP Concept**

This minimal data structure enables **AI-powered adaptive learning** with just **5 entities and ~30 fields**. The design focuses on capturing the essential data needed for:

- **RAG-Powered Content Generation** → Generate questions on-demand using Weaviate
- **Personalization** → Track user's weak concepts and learning patterns
- **Adaptation** → AI selects next questions based on performance
- **Learning Loop** → Continuous improvement based on user answers

**Goal:** Prove the AI learning pipeline works with absolute minimal complexity.

---

## 📊 **Core Entities**

### 1. **User**
```json
{
  "user_id": "user_123",
  "current_level": "intermediate",
  "concept_mastery": { "atomic_structure": 0.75, "chemical_bonding": 0.45 },
  "weak_concepts": ["chemical_bonding", "thermodynamics"],
  "learning_velocity": 0.8
}
```

### 2. **Question**
```json
{
  "question_id": "q1_atomic_structure",
  "text": "Which structure provides the atomic number?",
  "category": "Basic Sciences",
  "subcategory": "General Chemistry", 
  "topic": "atomic_structure",
  "difficulty": "intermediate",
  "options": [
    {"id": "a", "text": "Number of protons"},
    {"id": "b", "text": "Number of electrons"},
    {"id": "c", "text": "Number of neutrons"},
    {"id": "d", "text": "Atomic mass"}
  ],
  "correct_answer": "a",
  "explanation": "The atomic number is defined by the number of protons..."
}
```

### 3. **Lesson** *(Generated by Weaviate RAG)*
```json
{
  "lesson_id": "lesson_001",
  "topic": "atomic_structure",
  "category": "Basic Sciences",
  "subcategory": "General Chemistry",
  "lesson_content": "Comprehensive educational content about atomic structure...",
  "learning_objectives": ["understand", "apply", "analyze"],
  "exercise_id": "ex_001",
  "difficulty_level": "intermediate",
  "generated_by": "weaviate_rag_pipeline",
  "created_at": "2024-01-15T10:30:00Z"
}
```

### 4. **Exercise** *(Group of Questions)*
```json
{
  "exercise_id": "ex_001",
  "lesson_id": "lesson_001", 
  "topic": "atomic_structure",
  "question_ids": ["q1_atomic_structure", "q2_electron_config", "q3_periodic_trends"],
  "difficulty_level": "intermediate",
  "target_concepts": ["atomic_structure", "electron_configuration"],
  "created_at": "2024-01-15T10:30:00Z"
}
```

### 5. **Session**
```json
{
  "session_id": "s_456",
  "user_id": "user_123",
  "lesson_id": "lesson_001",
  "exercise_id": "ex_001",
  "topic": "atomic_structure",
  "timestamp": "2024-01-15T10:30:00Z",
  "answers": [
    {
      "question_id": "q1_atomic_structure",
      "selected": "a",
      "is_correct": true,
      "time_ms": 15000,
      "topic": "atomic_structure"
    }
  ],
  "concept_scores": { "atomic_structure": 0.8, "chemical_bonding": 0.6 },
  "total_score": 0.7
}
```

## 🧠 **Weaviate Knowledge Base**
```json
{
  "title": "Atomic Structure Fundamentals",
  "content": "Atoms consist of protons, neutrons, and electrons...",
  "category": "Basic Sciences",
  "subcategory": "General Chemistry",
  "topic": "atomic_structure",
  "difficulty": "basic"
}
```

## 🔗 **Relationships**

```
User (1) ←→ (N) Session
Lesson (1) → (1) Exercise
Exercise (1) → (N) Question (via question_ids)
Session (N) → (1) Lesson
Session (N) → (1) Exercise
Session.answers (N) → (1) Question
MedicalDocument (N) ← RAG Search ← AI Lesson Generation
```

## ⚡ **AI-Powered Flow**

1. **User Request** → "I want to study atomic_structure"
2. **AI Lesson Generation** → RAG creates lesson content
3. **Exercise Creation** → Group related questions into exercise
4. **User Studies** → Read lesson then complete exercise (group of questions)
5. **Performance Tracking** → Update user.concept_mastery after exercise completion
6. **Adaptive Next** → AI generates next lesson+exercise based on performance

## 🎯 **Core Operations**

### **AI Lesson Generation**
```python
# Generate lesson with associated questions using Weaviate RAG
lesson_response = await create_adaptive_lesson(
    topic="atomic_structure",
    user_context=user
)

# Result includes:
# - lesson_content: Educational content
# - questions: List of generated questions
# - learning_objectives: What student will learn
```

### **AI Question Selection**
```python
# Get user's weak areas for targeted learning
weak_concepts = user.weak_concepts

# AI-powered question selection
next_questions = ai_select_questions(
    topic=requested_topic,
    weak_concepts=weak_concepts,
    difficulty=user.current_level,
    exclude_recent=user.recent_questions
)
```

### **Real-time Adaptation**
```sql
-- Update user mastery after each answer
UPDATE user.concept_mastery 
SET score = calculate_new_score(previous_score, is_correct, confidence)
WHERE user_id = ? AND concept = ?

-- Get next question based on performance
SELECT * FROM questions 
WHERE topic IN (user.weak_concepts) 
AND difficulty = user.current_level
ORDER BY ai_recommendation_score DESC
LIMIT 1
```

### **Performance Analysis**
```sql
-- Calculate concept mastery from recent sessions
SELECT topic, AVG(is_correct) as mastery_score
FROM session_answers 
WHERE user_id = ? AND timestamp > DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY topic

-- Update weak concepts list
UPDATE users SET weak_concepts = (
  SELECT topics WHERE mastery_score < 0.7 ORDER BY mastery_score ASC
)
```

## 📋 **Minimal Requirements**

- **~30 fields** across 5 entities
- **No complex relationships** - direct and simple
- **AI-driven** - questions generated/selected on-demand
- **Real-time adaptation** - immediate user state updates
- **Flat structure** - minimal nesting for maximum simplicity

## 🚀 **Implementation**

### **Dynamic Lesson Flow**
```python
# Generate lesson with associated exercise
lesson_response = await generate_lesson(user_id, topic)

# Save lesson
lesson = save_lesson(lesson_response.lesson_content)

# Create exercise grouping questions
exercise = create_exercise(
    lesson_id=lesson.lesson_id,
    question_ids=[q.question_id for q in lesson_response.questions]
)

# Save individual questions
save_questions(lesson_response.questions)

# Create session for the exercise
session = create_session(user_id, lesson.lesson_id, exercise.exercise_id)

# User studies lesson content, then completes exercise (group of questions)
for question_id in exercise.question_ids:
    question = get_question(question_id)
    answer = get_user_answer(question)
    
    # Track performance in real-time
    session.add_answer(answer)

# Update user mastery after completing full exercise
update_user_mastery_from_exercise(user, session.concept_scores)

return session
```

### **API Endpoint**
```python
POST /api/lessons/create
{
  "topic": "atomic_structure",
  "user_context": {
    "user_id": "user_123",
    "current_level": "intermediate",
    "weak_concepts": ["chemical_bonding"]
  }
}

# Returns complete lesson with questions
{
  "lesson_id": "lesson_001",
  "lesson_content": "Educational content...",
  "questions": [...],
  "learning_objectives": [...],
  "exercise_id": "ex_001"
}
```

This enables **AI-powered adaptive learning** with **minimal complexity**! 🚀

## 🔄 **Learning Loop**

1. **AI Lesson Generation** → RAG creates lesson + questions based on user.weak_concepts
2. **User Studies** → Read lesson content and learning objectives
3. **User Answers** → Complete questions and track performance  
4. **Immediate Adaptation** → Update concept_mastery after each lesson
5. **Smart Next Lesson** → AI generates next lesson based on updated weak areas

**Result**: AI-driven lessons with associated exercises and minimal data structure! 🎯